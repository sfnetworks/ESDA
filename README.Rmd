---
title: "Testing"
author: "Roger Bivand"
date: "16/6/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Testing linegraph morphing

```{r}
# packages
library(sf)
library(sfnetworks)
library(spdep)
library(tidygraph)
library(igraph)
library(dplyr)

# data
network_column <- st_sfc(
  st_linestring(matrix(c(0, -2, 0, -1, 0, 0), ncol = 2, byrow = TRUE)), 
  st_linestring(matrix(c(0, 2, 0, 1, 0, 0), ncol = 2, byrow = TRUE)), 
  st_linestring(matrix(c(-2, 0, -1, 0, 0, 0), ncol = 2, byrow = TRUE)), 
  st_linestring(matrix(c(2, 0, 1, 0, 0, 0), ncol = 2, byrow = TRUE)), 
  st_linestring(matrix(c(2, -2, 2, -1, 2, 0), ncol = 2, byrow = TRUE)),
  st_linestring(matrix(c(2, 2, 2, 1, 2, 0), ncol = 2, byrow = TRUE)), 
  st_linestring(matrix(c(2, 0, 3, 0, 4, 0), ncol = 2, byrow = TRUE))
)


# assign some random measurements to all edges
set.seed(1)
network_data <- st_as_sf(
  data.frame(x = runif(7)), 
  geometry = network_column
)

# plot
plot(st_geometry(network_data))

# create sfnetwork structure
sfnetwork_data = as_sfnetwork(network_data, directed = FALSE)

# plot the sfnetwork object
plot(sfnetwork_data)

# create the line graph
```



```{r}
dual = sfnetwork_data %N>% convert(to_linegraph)
dual
```

```{r}
am = igraph::as_adjacency_matrix(dual)
am_list = spdep::mat2listw(am)
x = sfnetwork_data %>% activate(edges) %>% pull(x)
```

```{r}
mi = moran(x, am_list, igraph::ecount(sfnetwork_data), spdep::Szero(am_list))
mi
```

